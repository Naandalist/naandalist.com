---
import { Image } from "astro:assets";
import { getCollection } from "astro:content";

import defaultImage from "@assets/images/nanda-on-mount-merbabu.jpg";
import { SITE } from "@constants";
import { useTranslations } from "@i18n/utils";

import ArrowCard from "@components/ArrowCard.astro";
import Container from "@components/Container.astro";
import Link from "@components/Link.astro";
import ProjectCard from "@components/ProjectCard.astro";
import Socials from "@components/Socials.astro";

import PageLayout from "@layouts/PageLayout.astro";

import { dateRange } from "@lib/utils";

interface Props {
  lang?: "en" | "id";
}

const { lang = "en" } = Astro.props;
const t = useTranslations(lang);

const introPara2 = `${t("home.intro.paragraph2")} React ${t("home.intro.paragraph2.and")} Astro${t("home.intro.paragraph2.end")}`;

const posts = (await getCollection("posts"))
  .filter((post) => !post.data.draft && post.data.lang === lang)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, SITE.NUM_POSTS_ON_HOMEPAGE);

const projects = (await getCollection("projects"))
  .filter((project) => !project.data.draft && project.data.lang === lang)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, SITE.NUM_PROJECTS_ON_HOMEPAGE);

const allwork = (await getCollection("work"))
  .filter((work) => work.data.lang === lang)
  .sort(
    (a, b) =>
      new Date(b.data.dateStart).valueOf() -
      new Date(a.data.dateStart).valueOf()
  )
  .slice(0, SITE.NUM_WORKS_ON_HOMEPAGE);

const work = await Promise.all(
  allwork.map(async (item) => {
    const { Content } = await item.render();
    return { ...item, Content };
  })
);

const jsonLd = {
  "@context": "https://schema.org",
  "@type": "Person",
  name: "Listiananda Apriliawan",
  alternateName: "Naandalist",
  url: SITE.URL ?? "https://naandalist.com",
  image: `${SITE.URL ?? "https://naandalist.com"}/images/nanda-on-mount-merbabu.jpg`,
  jobTitle: "Frontend Engineer",
  worksFor: {
    "@type": "Organization",
    name: "Airpaz",
  },
  sameAs: [
    "https://github.com/Naandalist",
    "https://www.linkedin.com/in/naandalist",
    "https://twitter.com/naandalist",
  ],
  knowsAbout: [
    "React Native",
    "TypeScript",
    "JavaScript",
    "Bun",
    "Node.js",
    "Web Development",
    "Mobile Development",
    "Frontend Development",
    "Coding",
    "Personal Portofolio",
  ],
};
---

<PageLayout title={t("home.title")} description={t("home.description")}>
  <script
    is:inline
    type='application/ld+json'
    set:html={JSON.stringify(jsonLd)}
  />
  <Container>
    <h1 class='animate font-semibold text-white'>
      {t("home.greeting")}
    </h1>
    <div class='space-y-16'>
      <section>
        <article class='space-y-4'>
          <p class='animate'>
            {t("home.intro.paragraph1")} <Link
              href='https://reactnative.dev/'
              aria-label='React Native'
              external>React Native</Link
            > {t("home.intro.paragraph1.end")} <Link
              href='https://www.typescriptlang.org/'
              aria-label='TypeScript'
              external>TypeScript</Link
            > {t("home.intro.paragraph1.tooling")} <Link
              href='https://nodejs.org/en'
              aria-label='Node.js'
              external>Node.js</Link
            > {t("home.intro.paragraph1.needed")}
          </p>
          <p class='animate'>
            {introPara2}
          </p>
        </article>

        <figure class='relative col-span-2 sm:col-span-1 animate mt-4'>
          <Image
            alt='Naandalist hiking on Mount Merbabu'
            src={defaultImage}
            class='rounded-lg object-cover w-full h-full'
            width={800}
            height={600}
            loading='eager'
            fetchpriority='high'
          />
          <figcaption class='text-sm text-white/60 mt-3'>
            {t("home.image.caption")}
          </figcaption>
        </figure>

        <section class='animate space-y-6 mt-10'>
          <div class=''>
            <p
              class='text-xs font-medium uppercase tracking-[0.18em] text-white'
            >
              {t("home.skills")}
            </p>
            <div class='flex flex-wrap items-center gap-2 mt-5'>
              <img
                src='/icons/skill-dev.svg'
                alt='Tech stack icons'
                class='animate'
                fetchpriority='high'
              />
            </div>
          </div>
        </section>

        <section class='animate space-y-6 mt-10'>
          <div class='flex flex-wrap gap-y-2 items-center justify-between'>
            <h3
              class='text-xs font-medium uppercase tracking-[0.18em] text-white'
            >
              {t("home.work")}
            </h3>
            <Link href={lang === "en" ? "/work" : "/id/work"}>
              <span class='text-xs font-medium uppercase tracking-[0.18em]'>
                {t("home.work.seeAll")}
              </span>
            </Link>
          </div>
          <ul class='flex flex-col space-y-4'>
            {
              work.map((entry) => (
                <li class='animate flex items-start gap-4'>
                  <Image
                    src={entry.data.logoUrl}
                    alt='Company logo'
                    class='w-12 h-12 object-contain rounded mt-1'
                  />
                  <div>
                    <div class='text-sm opacity-75'>
                      {dateRange(entry.data.dateStart, entry.data.dateEnd)}
                    </div>
                    <div class='font-semibold text-white'>
                      {entry.data.company}
                    </div>
                    <div class='text-sm opacity-75'>{entry.data.role}</div>
                    <article class='work-summary-home'>
                      <entry.Content />
                    </article>
                  </div>
                </li>
              ))
            }
          </ul>
        </section>

        <section class='animate space-y-6 mt-10'>
          <div class='flex flex-wrap gap-y-2 items-center justify-between'>
            <h3
              class='text-xs font-medium uppercase tracking-[0.18em] text-white'
            >
              {t("home.projects")}
            </h3>
            <Link href={lang === "en" ? "/projects" : "/id/projects"}>
              <span class='text-xs font-medium uppercase tracking-[0.18em]'>
                {t("home.projects.seeAll")}
              </span>
            </Link>
          </div>
          <div class='flex flex-col gap-4'>
            {
              projects.map((project) => (
                <ProjectCard entry={project} lang={lang} />
              ))
            }
          </div>
        </section>

        <section class='animate space-y-6 mt-10'>
          <div class='flex flex-wrap gap-y-2 items-center justify-between'>
            <h3
              class='text-xs font-medium uppercase tracking-[0.18em] text-white'
            >
              {t("home.posts")}
            </h3>
            <Link href={lang === "en" ? "/posts" : "/id/posts"}>
              <span class='text-xs font-medium uppercase tracking-[0.18em]'>
                {t("home.posts.seeAll")}
              </span>
            </Link>
          </div>
          <ul class='flex flex-col gap-4'>
            {
              posts.map((post) => (
                <li>
                  <ArrowCard entry={post} lang={lang} />
                </li>
              ))
            }
          </ul>
        </section>

        <section class='animate space-y-4 mt-10'>
          <h3 class='font-semibold text-white'>
            {t("home.connect")}
          </h3>
          <article>
            <p class='animate'>
              {t("home.connect.desc1")}
            </p>
            <p class='animate'>
              {t("home.connect.desc2")}
              <Link
                href='mailto:dev@naandalist.com'
                aria-label='Email Naandalist'
              >
                dev@naandalist.com
              </Link>
              {t("home.connect.or")}
            </p>
          </article>
          <Socials />
        </section>
      </section>
    </div>
  </Container>
</PageLayout>
