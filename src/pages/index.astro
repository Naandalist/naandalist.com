---
import { getCollection } from "astro:content";
import Container from "@components/Container.astro";
import PageLayout from "@layouts/PageLayout.astro";
import ArrowCard from "@components/ArrowCard.astro";
import ProjectCard from "@components/ProjectCard.astro";
import Link from "@components/Link.astro";
import { dateRange } from "@lib/utils";
import { SITE, HOME, SOCIALS } from "@consts";

const posts = (await getCollection("posts"))
  .filter((post) => !post.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, SITE.NUM_POSTS_ON_HOMEPAGE);

const projects = (await getCollection("projects"))
  .filter((project) => !project.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, SITE.NUM_PROJECTS_ON_HOMEPAGE);

const allwork = (await getCollection("work"))
  .sort(
    (a, b) =>
      new Date(b.data.dateStart).valueOf() -
      new Date(a.data.dateStart).valueOf()
  )
  .slice(0, SITE.NUM_WORKS_ON_HOMEPAGE);

const work = await Promise.all(
  allwork.map(async (item) => {
    const { Content } = await item.render();
    return { ...item, Content };
  })
);
---

<PageLayout title={HOME.TITLE} description={HOME.DESCRIPTION}>
  <Container>
    <h4 class='animate font-semibold text-black dark:text-white'>
      Hello, Naandalist here <span class='text-xl'>üëãüèª</span>
    </h4>
    <div class='space-y-16'>
      <section>
        <article class='space-y-4'>
          <p class='animate'>
            Listiananda Apriliawan, a Frontend engineer who currently working at <Link
              href='https://www.airpaz.com/en'
              aria-label='Airpaz'
              external
            >
              Airpaz
            </Link>, an Online Travel Agency (OTA). His daily work involves
            using React Native, JavaScript, TypeScript, Bun, and Node.js to
            build and maintain Android and iOS features, helping people connect
            with their travel dreams.
          </p>
        </article>

        <div class='relative col-span-2 sm:col-span-1 animate'>
          <img
            alt='Naandalist hiking on Mount Merbabu'
            src='/images/nanda-on-mount-merbabu.jpg'
            class='rounded-lg object-cover w-full h-full'
            loading='lazy'
          />

          <article class='space-y-4'>
            <p class='animate'>
              When he's not immersed in lines of code, you'll likely find him
              scaling new heights ‚Äì literally! He's an enthusiastic mountain
              hiker, believing that the best views come after the hardest
              climbs.
            </p>
          </article>
        </div>

        <section class='animate'>
          <div class=''>
            <p class='font-semibold text-black dark:text-white'>Skilled in</p>
            <div class='flex flex-wrap items-center gap-2 mt-5'>
              <img
                src='https://skillicons.dev/icons?i=js,figma,mongo,ts,nodejs,vscode,tailwind,react,next,github,azure,gitlab'
                alt='Tech stack icons'
                class='animate'
                loading='lazy'
              />
            </div>
          </div>
        </section>

        <section class='animate space-y-6 mt-10'>
          <div class='flex flex-wrap gap-y-2 items-center justify-between'>
            <h5 class='font-semibold text-black dark:text-white'>
              Work Experience
            </h5>
            <Link href='/work'> See all work </Link>
          </div>
          <ul class='flex flex-col space-y-4'>
            {
              work.map((entry) => (
                <li class='animate flex items-start gap-4'>
                  <img
                    src={entry.data.logoUrl}
                    alt='Company logo'
                    class='w-12 h-12 object-contain rounded mt-1'
                    loading='lazy'
                  />
                  <div>
                    <div class='text-sm opacity-75'>
                      {dateRange(entry.data.dateStart, entry.data.dateEnd)}
                    </div>
                    <div class='font-semibold text-black dark:text-white'>
                      {entry.data.company}
                    </div>
                    <div class='text-sm opacity-75'>{entry.data.role}</div>
                    <article>
                      <entry.Content />
                    </article>
                  </div>
                </li>
              ))
            }
          </ul>
        </section>

        <section class='animate space-y-6 mt-10'>
          <div class='flex flex-wrap gap-y-2 items-center justify-between'>
            <h5 class='font-semibold text-black dark:text-white'>
              Recent projects
            </h5>
            <Link href='/projects'> See all projects </Link>
          </div>
          <div class='flex flex-col gap-4'>
            {projects.map((project) => <ProjectCard entry={project} />)}
          </div>
        </section>

        <section class='animate space-y-6 mt-10'>
          <div class='flex flex-wrap gap-y-2 items-center justify-between'>
            <h5 class='font-semibold text-black dark:text-white'>
              Latest posts
            </h5>
            <Link href='/posts'> See all posts </Link>
          </div>
          <ul class='flex flex-col gap-4'>
            {
              posts.map((post) => (
                <li>
                  <ArrowCard entry={post} />
                </li>
              ))
            }
          </ul>
        </section>

        <section class='animate space-y-4 mt-10'>
          <h5 class='font-semibold text-black dark:text-white'>
            Let's Connect
          </h5>
          <article>
            <p class='animate'>
              Naandalist is Listiananda Apriliawan's often used username across
              his public accounts.
            </p>
            <p class='animate'>
              If you want to get in touch with him about something or just to
              say hi, reach out on social media or send him an email to{" "}
              <Link
                href='mailto:dev@naandalist.com'
                aria-label='Email Naandalist'
              >
                dev@naandalist.com
              </Link>.
            </p>
          </article>
          <ul class='flex flex-wrap gap-10'>
            {
              SOCIALS.map((SOCIAL) => (
                <li class='flex gap-x-2 text-nowrap items-center'>
                  <div class='flex items-center gap-2'>
                    <a
                      href={SOCIAL.HREF}
                      target='_blank'
                      rel='noopener noreferrer'
                      class='inline-block text-current hover:text-black dark:hover:text-white no-underline transition-colors duration-300 ease-in-out'
                      aria-label={`${SITE.NAME} on ${SOCIAL.NAME}`}
                    >
                      <i class={`fab fa-${SOCIAL.NAME} text-sm`} />
                      {SOCIAL.NAME}
                    </a>
                  </div>
                </li>
              ))
            }
          </ul>
        </section>
      </section>
    </div>
  </Container>
</PageLayout>
